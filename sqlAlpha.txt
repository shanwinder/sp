\<immersive type="text/code" lang="sql" title="Final SQL Schema"\>
\-- =================================================================
\-- SQL Schema for "Alpha's Adventure" Online Skill-Training Game
\-- Final Version - Compiled from all requirements
\-- =================================================================

\-- ตารางที่ 1: จัดการข้อมูลผู้ใช้งาน
\-- เก็บข้อมูลผู้ใช้งานระบบทั้งหมด ทั้งนักเรียนและผู้ดูแลระบบ
CREATE TABLE `users` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`student_id` VARCHAR(20) NOT NULL UNIQUE COMMENT 'รหัสนักเรียนสำหรับเข้าระบบ',
`name` VARCHAR(100) NOT NULL COMMENT 'ชื่อ-สกุลของนักเรียน',
`class_level` VARCHAR(10) NOT NULL COMMENT 'ระดับชั้น เช่น ป.4/1',
`password` VARCHAR(255) NOT NULL COMMENT 'รหัสผ่านที่เข้ารหัสแล้ว',
`role` ENUM('student', 'admin') DEFAULT 'student' COMMENT 'บทบาทผู้ใช้',
`created_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 2: จัดการบทเรียนหลักของเกม (Chapters)
\-- เก็บข้อมูลบทเรียนหลักทั้ง 5 บทของเกม
CREATE TABLE `chapters` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`chapter_number` INT NOT NULL UNIQUE COMMENT 'ลำดับของบทเรียน เช่น 1, 2, 3',
`title` VARCHAR(255) NOT NULL COMMENT 'ชื่อบทเรียน เช่น การเอาชีวิตรอด ณ จุดตก',
`description` TEXT COMMENT 'คำอธิบายภาพรวมของบทเรียน',
`created_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 3: จัดการด่านย่อยในแต่ละบท (Stages)
\-- เก็บข้อมูลด่านย่อยทั้ง 50 ด่านของเกม
CREATE TABLE `stages` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`chapter_id` INT NOT NULL COMMENT 'เชื่อมโยงไปยังบทเรียน (FK to chapters.id)',
`stage_number` INT NOT NULL COMMENT 'ลำดับของด่านในบทนั้นๆ (เช่น ด่านที่ 1-50)',
`title` VARCHAR(255) COMMENT 'ชื่อด่าน เช่น ประกอบร่างให้อัลฟ่า',
`instruction` TEXT COMMENT 'คำสั่งหรือเป้าหมายของด่าน',
`content_json` JSON COMMENT 'เก็บข้อมูลเฉพาะของด่าน เช่น ตำแหน่งของวัตถุ, คำถาม',
FOREIGN KEY (`chapter_id`) REFERENCES `chapters`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 4: บันทึกความก้าวหน้าการเล่น (Progress)
\-- บันทึกผลลัพธ์และความก้าวหน้าการเล่นแต่ละด่านของผู้เรียน
CREATE TABLE `progress` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`user_id` INT NOT NULL,
`stage_id` INT NOT NULL,
`stars_awarded` TINYINT DEFAULT 0 COMMENT 'จำนวนดาวที่ได้รับ (0-3 ดาว) สะท้อนผลการเรียนรู้',
`is_efficiency_goal_met` BOOLEAN DEFAULT 0 COMMENT 'บรรลุเป้าหมายด้านประสิทธิภาพหรือไม่ (สำหรับดาวดวงที่ 2)',
`is_exploratory_goal_met` BOOLEAN DEFAULT 0 COMMENT 'บรรลุเป้าหมายการสำรวจหรือไม่ (สำหรับดาวดวงที่ 3)',
`duration_seconds` INT DEFAULT 0 COMMENT 'ระยะเวลาที่ใช้ในการผ่านด่าน (วินาที)',
`attempts` INT DEFAULT 1 COMMENT 'จำนวนครั้งที่ลองเล่นด่านนี้',
`completed_at` DATETIME COMMENT 'เวลาที่ผ่านด่านสำเร็จ',
UNIQUE KEY `user_stage_unique` (`user_id`, `stage_id`),
FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
FOREIGN KEY (`stage_id`) REFERENCES `stages`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 5: บันทึกพฤติกรรมการเล่น (Game Logs)
\-- บันทึกพฤติกรรมการเล่นทุกอย่างของผู้เรียนเพื่อการวิเคราะห์เชิงลึก (Learning Analytics)
CREATE TABLE `game_logs` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`user_id` INT NOT NULL,
`stage_id` INT NOT NULL,
`action` ENUM('start', 'submit', 'hint', 'pass', 'fail') NOT NULL COMMENT 'ประเภทของพฤติกรรมที่บันทึก',
`detail` TEXT COMMENT 'รายละเอียดเพิ่มเติม เช่น คำตอบที่ส่ง',
`logged_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP,
FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
FOREIGN KEY (`stage_id`) REFERENCES `stages`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 6: จัดการไอเทมสำหรับปรับแต่งตัวละคร (Customization Items)
\-- เก็บรายการไอเทมสำหรับตกแต่งตัวละคร Alpha และเงื่อนไขการปลดล็อกทั้งหมด
CREATE TABLE `customization_items` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`item_name` VARCHAR(100) NOT NULL COMMENT 'ชื่อไอเทม เช่น สีล้อสีแดง, เสาอากาศแบบสายฟ้า',
`item_type` ENUM('wheel\_color', 'antenna', 'sticker', 'expression') NOT NULL COMMENT 'ประเภทของไอเทม',
`description` TEXT,
`image_url` VARCHAR(255) COMMENT 'ตำแหน่งไฟล์ภาพของไอเทม',
`milestone_stage_id` INT NOT NULL COMMENT 'ID ของด่านที่เป็นเงื่อนไขการปลดล็อก (FK to stages.id)',
`required_cumulative_stars` INT NOT NULL DEFAULT 0 COMMENT 'จำนวนดาวสะสมขั้นต่ำที่ต้องมีเพื่อปลดล็อกไอเทมนี้',
FOREIGN KEY (`milestone_stage_id`) REFERENCES `stages`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 7: บันทึกไอเทมที่ผู้เล่นปลดล็อก (User Unlocked Items)
\-- บันทึกว่าผู้เล่นคนไหนปลดล็อกไอเทมอะไรไปแล้วบ้าง
CREATE TABLE `user_unlocked_items` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`user_id` INT NOT NULL,
`item_id` INT NOT NULL,
`unlocked_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP,
UNIQUE KEY `user_item_unique` (`user_id`, `item_id`),
FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
FOREIGN KEY (`item_id`) REFERENCES `customization_items`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- =================================================================
\-- ตารางสำหรับระบบแบบทดสอบ (Pre-test/Post-test)
\-- =================================================================

\-- ตารางที่ 8: กำหนดชุดแบบทดสอบ
CREATE TABLE `assessments` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`title` VARCHAR(255) NOT NULL,
`description` TEXT COMMENT 'คำอธิบายเพิ่มเติมเกี่ยวกับแบบทดสอบนี้',
`type` ENUM('pre-test', 'post-test', 'quiz') NOT NULL COMMENT 'ประเภทของแบบทดสอบ',
`created_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 9: คลังคำถามของแบบทดสอบ
CREATE TABLE `assessment_questions` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`assessment_id` INT NOT NULL,
`question_number` INT NOT NULL COMMENT 'ลำดับของคำถามในชุดทดสอบ',
`question_type` ENUM('multiple\_choice', 'ordering', 'fill\_in\_the\_blank') NOT NULL,
`question_text` TEXT,
`question_data_json` JSON COMMENT 'เก็บข้อมูลเพิ่มเติม เช่น รูปภาพประกอบ หรือชุดคำสำหรับเรียงลำดับ',
`options_json` JSON COMMENT 'เก็บตัวเลือกสำหรับคำถามแบบ multiple\_choice',
`correct_answer_json` JSON NOT NULL COMMENT 'เก็บคำตอบที่ถูกต้องในรูปแบบ JSON เพื่อรองรับหลายคำตอบหรือการเรียงลำดับ',
`points` INT DEFAULT 1 COMMENT 'คะแนนสำหรับคำถามข้อนี้',
FOREIGN KEY (`assessment_id`) REFERENCES `assessments`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 10: ผลการทำแบบทดสอบ
CREATE TABLE `assessment_results` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`user_id` INT NOT NULL,
`assessment_id` INT NOT NULL,
`score` INT NOT NULL,
`max_score` INT NOT NULL COMMENT 'คะแนนเต็มของแบบทดสอบชุดนั้น',
`submitted_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP,
UNIQUE KEY `user_assessment_unique` (`user_id`, `assessment_id`),
FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE,
FOREIGN KEY (`assessment_id`) REFERENCES `assessments`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- ตารางที่ 11: คำตอบรายข้อของนักเรียน
CREATE TABLE `student_assessment_answers` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`result_id` INT NOT NULL COMMENT 'เชื่อมโยงไปยัง id ของการทำแบบทดสอบครั้งนั้นๆ',
`question_id` INT NOT NULL,
`answer_given_json` JSON NOT NULL COMMENT 'คำตอบที่นักเรียนตอบ',
`is_correct` BOOLEAN NOT NULL COMMENT 'เก็บผลว่าข้อนี้ตอบถูก (1) หรือผิด (0)',
FOREIGN KEY (`result_id`) REFERENCES `assessment_results`(`id`) ON DELETE CASCADE,
FOREIGN KEY (`question_id`) REFERENCES `assessment_questions`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\-- =================================================================
\-- ตารางสำหรับเก็บ Feedback (ส่วนเสริม)
\-- =================================================================

\-- ตารางที่ 12: ความคิดเห็นของนักเรียน
CREATE TABLE `student_feedback` (
`id` INT AUTO\_INCREMENT PRIMARY KEY,
`user_id` INT NOT NULL,
`chapter_id` INT COMMENT 'อาจจะให้ feedback หลังจบเกม/บทเรียน',
`stage_id` INT COMMENT 'หรือจะให้ feedback หลังจบด่าน',
`rating` TINYINT NOT NULL COMMENT 'เช่น 1-5 ดาว',
`comment` TEXT,
`created_at` TIMESTAMP DEFAULT CURRENT\_TIMESTAMP,
FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

\</immersive\>